var io=require("socket.io-client"),L=L||{};L.Base64=function(e){"use strict";var t,n,r,i,s,o,u,a,f,l,c,h;t=-1,n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],r=[];for(o=0;o<n.length;o+=1)r[n[o]]=o;return u=function(e){i=e,s=0},a=function(){var e;return i?s>=i.length?t:(e=i.charCodeAt(s)&255,s+=1,e):t},f=function(e){var r,i,s,o;u(e),r="",i=new Array(3),s=0,o=!1;while(!o&&(i[0]=a())!==t)i[1]=a(),i[2]=a(),r+=n[i[0]>>2],i[1]!==t?(r+=n[i[0]<<4&48|i[1]>>4],i[2]!==t?(r+=n[i[1]<<2&60|i[2]>>6],r+=n[i[2]&63]):(r+=n[i[1]<<2&60],r+="=",o=!0)):(r+=n[i[0]<<4&48],r+="=",r+="=",o=!0),s+=4,s>=76&&(r+="\n",s=0);return r},l=function(){if(!i)return t;for(;;){if(s>=i.length)return t;var e=i.charAt(s);s+=1;if(r[e])return r[e];if(e==="A")return 0}},c=function(e){return e=e.toString(16),e.length===1&&(e="0"+e),e="%"+e,unescape(e)},h=function(e){var n,r,i;u(e),n="",r=new Array(4),i=!1;while(!i&&(r[0]=l())!==t&&(r[1]=l())!==t)r[2]=l(),r[3]=l(),n+=c(r[0]<<2&255|r[1]>>4),r[2]!==t?(n+=c(r[1]<<4&255|r[2]>>2),r[3]!==t?n+=c(r[2]<<6&255|r[3]):i=!0):i=!0;return n},{encodeBase64:f,decodeBase64:h}}(L);var L=L||{};L.Logger=function(e){"use strict";var t=0,n=1,r=2,i=3,s=4,o=5,u=t,a,f,l,c,h,p,d,v;return a=function(){e.Logger.panel=document.createElement("textarea"),e.Logger.panel.setAttribute("id","lynckia-logs"),e.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none"),e.Logger.panel.setAttribute("rows",20),e.Logger.panel.setAttribute("cols",20),e.Logger.panel.setAttribute("readOnly",!0),document.body.appendChild(e.Logger.panel)},f=function(t){t>e.Logger.NONE?t=e.Logger.NONE:t<e.Logger.DEBUG&&(t=e.Logger.DEBUG),e.Logger.logLevel=t},l=function(t,n){var r="";if(t<e.Logger.logLevel)return;t===e.Logger.DEBUG?r+="DEBUG":t===e.Logger.TRACE?r+="TRACE":t===e.Logger.INFO?r+="INFO":t===e.Logger.WARNING?r+="WARNING":t===e.Logger.ERROR&&(r+="ERROR"),r=r+": "+n,e.Logger.panel!==undefined?e.Logger.panel.value=e.Logger.panel.value+"\n"+r:console.log(r)},c=function(t){e.Logger.log(e.Logger.DEBUG,t)},h=function(t){e.Logger.log(e.Logger.TRACE,t)},p=function(t){e.Logger.log(e.Logger.INFO,t)},d=function(t){e.Logger.log(e.Logger.WARNING,t)},v=function(t){e.Logger.log(e.Logger.ERROR,t)},{DEBUG:t,TRACE:n,INFO:r,WARNING:i,ERROR:s,NONE:o,enableLogPanel:a,setLogLevel:f,log:l,debug:c,trace:h,info:p,warning:d,error:v}}(L);var Erizo=Erizo||{};Erizo.FcStack=function(e){"use strict";var t={};return t.addStream=function(e){},t};var Erizo=Erizo||{};Erizo.ChromeStableStack=function(e){"use strict";var t={},n=webkitRTCPeerConnection;return t.pc_config={iceServers:[]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),t.mediaConstraints={mandatory:{OfferToReceiveVideo:"true",OfferToReceiveAudio:"true"}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config),t.peerConnection.onicecandidate=function(e){e.candidate?t.iceCandidateCount+=1:(t.moreIceComing=!1,t.markActionNeeded())},console.log('Created webkitRTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.processSignalingMessage=function(e){console.log("Activity on conn "+t.sessionId);var n=JSON.parse(e),r;t.incomingMessage=n,t.state==="new"?n.messageType==="OFFER"?(r={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="offer-sent"?n.messageType==="ANSWER"?(r={sdp:n.sdp,type:"answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.sendOK(),t.state="established"):n.messageType==="pr-answer"?(r={sdp:n.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):n.messageType==="offer"?t.error("Not written yet"):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="established"&&(n.messageType==="OFFER"?(r={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(e){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e,n={};if(t.actionNeeded){if(t.state==="new"||t.state==="established")t.peerConnection.createOffer(function(e){var n=e.sdp;if(n!==t.prevOffer){t.peerConnection.setLocalDescription(e),t.state="preparing-offer",t.markActionNeeded();return}console.log("Not sending a new offer")},null,t.mediaConstraints);else if(t.state==="preparing-offer"){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,console.log("Sending OFFER: ",t.prevOffer),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if(t.state==="offer-received")t.peerConnection.createAnswer(function(e){t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer";if(!!t.iceStarted){t.markActionNeeded();return}var n=new Date;console.log(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0},null,t.mediaConstraints);else if(t.state==="offer-received-preparing-answer"){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,e==="OFFER"?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(Math.random()*429496723+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.onopen=function(){t.onopen&&t.onopen()},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t};var Erizo=Erizo||{};Erizo.ChromeCanaryStack=function(e){"use strict";var t={},n=webkitRTCPeerConnection;return t.pc_config={iceServers:[]},e.stunServerUrl!==undefined&&t.pc_config.iceServers.push({url:e.stunServerUrl}),t.mediaConstraints={mandatory:{OfferToReceiveVideo:"true",OfferToReceiveAudio:"true"}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config),t.peerConnection.onicecandidate=function(n){console.log("PeerConnection: ",e.session_id),n.candidate?t.iceCandidateCount+=1:(console.log("State: "+t.peerConnection.iceGatheringState),t.ices===undefined&&(t.ices=0),t.ices=t.ices+1,console.log(t.ices),t.ices>=1&&t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded()))},console.log('Created webkitRTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.processSignalingMessage=function(e){console.log("Activity on conn "+t.sessionId);var n=JSON.parse(e),r,i,s;t.incomingMessage=n,t.state==="new"?n.messageType==="OFFER"?(r={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="offer-sent"?n.messageType==="ANSWER"?(i=new RegExp(/m=video[\w\W]*\r\n/g),s=n.sdp.match(i),console.log(s),n.sdp=n.sdp.replace(i,s+"b=AS:100\r\n"),r={sdp:n.sdp,type:"answer"},console.log("Received ANSWER: ",r),t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.sendOK(),t.state="established"):n.messageType==="pr-answer"?(r={sdp:n.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r))):n.messageType==="offer"?t.error("Not written yet"):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state):t.state==="established"&&(n.messageType==="OFFER"?(r={sdp:n.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+n.messageType+" in state "+t.state))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(e){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater(function(){t.onstablestate()})},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e,n={};if(t.actionNeeded){if(t.state==="new"||t.state==="established")t.peerConnection.createOffer(function(e){var n=e.sdp;console.log("Changed",e.sdp);if(n!==t.prevOffer){t.peerConnection.setLocalDescription(e),t.state="preparing-offer",t.markActionNeeded();return}console.log("Not sending a new offer")},null,t.mediaConstraints);else if(t.state==="preparing-offer"){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,console.log("Sending OFFER: ",t.prevOffer),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if(t.state==="offer-received")t.peerConnection.createAnswer(function(e){t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer";if(!!t.iceStarted){t.markActionNeeded();return}var n=new Date;console.log(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0},null,t.mediaConstraints);else if(t.state==="offer-received-preparing-answer"){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,e==="OFFER"?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(Math.random()*429496723+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.onopen=function(){t.onopen&&t.onopen()},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t};var Erizo=Erizo||{};Erizo.View=function(e){"use strict";var t=Erizo.EventDispatcher({});return t.url="http://chotis2.dit.upm.es:3000",t};var Erizo=Erizo||{};Erizo.VideoPlayer=function(e){"use strict";var t=Erizo.View({}),n,r;return t.id=e.id,t.stream=e.stream,t.elementID=e.elementID,n=function(e){t.bar.display()},r=function(e){t.bar.hide()},t.destroy=function(){t.video.pause(),clearInterval(t.resize),t.parentNode.removeChild(t.div)},window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,n){document.getElementById(t).value=unescape(n)}),L.Logger.debug("Creating URL from stream "+t.stream),t.stream_url=webkitURL.createObjectURL(t.stream),t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),t.loader=document.createElement("img"),t.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.loader.setAttribute("id","back_"+t.id),t.loader.setAttribute("src",t.url+"/assets/loader.gif"),t.video=document.createElement("video"),t.video.setAttribute("id","stream"+t.id),t.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.video.setAttribute("autoplay","autoplay"),t.elementID!==undefined?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode,t.div.appendChild(t.loader),t.div.appendChild(t.video),t.containerWidth=0,t.containerHeight=0,t.resize=setInterval(function(){var e=t.container.offsetWidth,n=t.container.offsetHeight;if(e!==t.containerWidth||n!==t.containerHeight)e*.75>n?(t.video.style.width=e+"px",t.video.style.height=.75*e+"px",t.video.style.top=-(.75*e/2-n/2)+"px",t.video.style.left="0px"):(t.video.style.height=n+"px",t.video.style.width=4/3*n+"px",t.video.style.left=-(4/3*n/2-e/2)+"px",t.video.style.top="0px"),t.containerWidth=e,t.containerHeight=n},500),t.bar=new Erizo.Bar({elementID:"player_"+t.id,id:t.id,video:t.video,options:e.options}),t.div.onmouseover=n,t.div.onmouseout=r,t.video.src=t.stream_url,t};var Erizo=Erizo||{};Erizo.Bar=function(e){"use strict";var t=Erizo.View({}),n,r;t.elementID=e.elementID,t.id=e.id,t.div=document.createElement("div"),t.div.setAttribute("id","bar_"+t.id),t.bar=document.createElement("div"),t.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),t.bar.setAttribute("id","subbar_"+t.id),t.link=document.createElement("a"),t.link.setAttribute("href","http://www.lynckia.com/"),t.link.setAttribute("target","_blank"),t.logo=document.createElement("img"),t.logo.setAttribute("style","width: 10%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;"),t.logo.setAttribute("alt","Lynckia"),t.logo.setAttribute("src",t.url+"/assets/star.svg"),r=function(e){e!=="block"?e="none":clearTimeout(n),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+e)},t.display=function(){r("block")},t.hide=function(){n=setTimeout(r,1e3)},document.getElementById(t.elementID).appendChild(t.div),t.div.appendChild(t.bar),t.bar.appendChild(t.link),t.link.appendChild(t.logo);if(e.options===undefined||e.options.speaker===undefined||e.options.speaker===!0)t.speaker=new Erizo.Speaker({elementID:"subbar_"+t.id,id:t.id,video:e.video});return t.display(),t.hide(),t};var Erizo=Erizo||{};Erizo.Speaker=function(e){"use strict";var t=Erizo.View({}),n;return t.elementID=e.elementID,t.video=e.video,t.id=e.id,t.div=document.createElement("div"),t.div.setAttribute("style","width: 10%; height: 100%; max-width: 30px; position: absolute; bottom: 0; right: 0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_"+t.id),t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.icon.setAttribute("style","width: 100%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_"+t.id),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=50,t.div.appendChild(t.picker),t.video.volume=t.picker.value/100,t.picker.oninput=function(e){t.picker.value>0?t.icon.setAttribute("src",t.url+"/assets/sound48.png"):t.icon.setAttribute("src",t.url+"/assets/mute48.png"),t.video.volume=t.picker.value/100},n=function(e){t.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: "+t.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+e)},t.div.onmouseover=function(e){n("block")},t.div.onmouseout=function(e){n("none")},n("none"),document.getElementById(t.elementID).appendChild(t.div),t};var Erizo=Erizo||{};Erizo.Room=function(e){"use strict";var t=Erizo.EventDispatcher(e),n,r,i,s,o,u=0,a=1,f=2;return t.remoteStreams={},t.localStreams={},t.roomID="",t.socket={},t.state=u,t.addEventListener("room-disconnected",function(e){var n,r,i;t.state=u;for(n in t.remoteStreams)t.remoteStreams.hasOwnProperty(n)&&(r=t.remoteStreams[n],o(r),delete t.remoteStreams[n],i=Erizo.StreamEvent({type:"stream-removed",stream:r}),t.dispatchEvent(i));t.remoteStreams={};for(n in t.localStreams)t.localStreams.hasOwnProperty(n)&&(r=t.localStreams[n],o(r),delete t.localStreams[n]);try{t.socket.disconnect()}catch(s){L.Logger.debug("Socket already disconnected")}t.socket=undefined}),o=function(e){e.stream!==undefined&&(e.hide(),e.pc.close())},s=function(e,t){e.local&&r("sendDataStream",{id:e.getID(),msg:t})},n=function(e,n,i){t.socket=io.connect(e.host,{reconnect:!1}),t.socket.on("onAddStream",function(e){console.log(e);var n=Erizo.Stream({streamID:e.id,local:!1,audio:e.audio,video:e.video,data:e.data,attributes:e.attributes}),r;t.remoteStreams[e.id]=n,r=Erizo.StreamEvent({type:"stream-added",stream:n}),t.dispatchEvent(r)}),t.socket.on("onDataStream",function(e){var n=t.remoteStreams[e.id],r=Erizo.StreamEvent({type:"stream-data",msg:e.msg,stream:n});n.dispatchEvent(r)}),t.socket.on("onRemoveStream",function(e){var n=t.remoteStreams[e.id],r;delete t.remoteStreams[e.id],o(n),r=Erizo.StreamEvent({type:"stream-removed",stream:n}),t.dispatchEvent(r)}),t.socket.on("disconnect",function(e){L.Logger.info("Socket disconnected");var n=Erizo.RoomEvent({type:"room-disconnected"});t.dispatchEvent(n)}),r("token",e,n,i)},r=function(e,n,r,i){t.socket.emit(e,n,function(e,t){e==="success"?r!==undefined&&r(t):i!==undefined&&i(t)})},i=function(e,n,r,i){t.socket.emit(e,n,r,function(e,t){i!==undefined&&i(e,t)})},t.connect=function(){var r=[],i=L.Base64.decodeBase64(e.token);t.state!==u&&L.Logger.error("Room already connected"),t.state=a,n(JSON.parse(i),function(e){var n=0,r,i=[],s,o,u,a;s=e.streams,o=e.id,t.stunServerUrl=e.stunServerUrl,t.state=f;for(n in s)s.hasOwnProperty(n)&&(u=s[n],r=Erizo.Stream({streamID:u.id,local:!1,audio:u.audio,video:u.video,data:u.data,attributes:u.attributes}),i.push(r),t.remoteStreams[u.id]=r);t.roomID=o,L.Logger.info("Connected to room "+t.roomID),a=Erizo.RoomEvent({type:"room-connected",streams:i}),t.dispatchEvent(a)},function(e){L.Logger.error("Not Connected! Error: "+e)})},t.disconnect=function(){var e=Erizo.RoomEvent({type:"room-disconnected"});t.dispatchEvent(e)},t.publish=function(e){e.local&&t.localStreams[e.getID()]===undefined&&(e.hasAudio()||e.hasVideo()?(e.pc=Erizo.Connection({callback:function(n){i("publish",{state:"offer",data:!0,audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes()},n,function(n,r){e.pc.onsignalingmessage=function(n){e.pc.onsignalingmessage=function(){},i("publish",{state:"ok",streamId:r,data:!0,audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes()},n),L.Logger.info("Stream published"),e.getID=function(){return r},e.sendData=function(t){s(e,t)},t.localStreams[r]=e},e.pc.processSignalingMessage(n)})},stunServerUrl:t.stunServerUrl}),e.pc.addStream(e.stream)):e.hasData()&&i("publish",{state:"data",data:!0,audio:!1,video:!1,attributes:e.getAttributes()},undefined,function(n,r){L.Logger.info("Stream published"),e.getID=function(){return r},e.sendData=function(t){s(e,t)},t.localStreams[r]=e}))},t.unpublish=function(e){e.local&&r("unpublish",e.getID())},t.subscribe=function(e){e.local||(e.hasVideo()||e.hasAudio()?(e.pc=Erizo.Connection({callback:function(t){i("subscribe",{streamId:e.getID()},t,function(t){e.pc.processSignalingMessage(t)})},stunServerUrl:t.stunServerUrl}),e.pc.onaddstream=function(n){L.Logger.info("Stream subscribed"),e.stream=n.stream;var r=Erizo.StreamEvent({type:"stream-subscribed",stream:e});t.dispatchEvent(r)}):e.hasData()&&i("subscribe",{streamId:e.getID()},undefined,function(n){L.Logger.info("Stream subscribed");var r=Erizo.StreamEvent({type:"stream-subscribed",stream:e});t.dispatchEvent(r)}),L.Logger.info("Subscribing to: "+e.getID()))},t.unsubscribe=function(e){t.socket!==undefined&&(e.local||r("unsubscribe",e.getID(),function(){o(e)},function(){L.Logger.error("Error calling unsubscribe.")}))},t.getStreamsByAttribute=function(e,n){var r=[],i,s;for(i in t.remoteStreams)t.remoteStreams.hasOwnProperty(i)&&(s=t.remoteStreams[i],s.getAttributes()!==undefined&&s.getAttributes()[e]!==undefined&&s.getAttributes()[e]===n&&r.push(s));return r},t};var Erizo=Erizo||{};Erizo.EventDispatcher=function(e){"use strict";var t={};return e.dispatcher={},e.dispatcher.eventListeners={},t.addEventListener=function(t,n){e.dispatcher.eventListeners[t]===undefined&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},t.removeEventListener=function(t,n){var r;r=e.dispatcher.eventListeners[t].indexOf(n),r!==-1&&e.dispatcher.eventListeners[t].splice(r,1)},t.dispatchEvent=function(t){var n;L.Logger.debug("Event: "+t.type);for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&e.dispatcher.eventListeners[t.type][n](t)},t},Erizo.LynckiaEvent=function(e){"use strict";var t={};return t.type=e.type,t},Erizo.RoomEvent=function(e){"use strict";var t=Erizo.LynckiaEvent(e);return t.streams=e.streams,t},Erizo.StreamEvent=function(e){"use strict";var t=Erizo.LynckiaEvent(e);return t.stream=e.stream,t.msg=e.msg,t},Erizo.PublisherEvent=function(e){"use strict";var t=Erizo.LynckiaEvent(e);return t};var Erizo=Erizo||{};Erizo.sessionId=103,Erizo.Connection=function(e){"use strict";var t={};e.session_id=Erizo.sessionId+=1,t.browser="";if(typeof module!="undefined"&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported in erizofc yet"),t=Erizo.FcStack(e);else if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]==="23")console.log("Stable!"),t=Erizo.ChromeStableStack(e),t.browser="chrome-stable";else if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]==="25")console.log("Canary!"),t=Erizo.ChromeCanaryStack(e),t.browser="chrome-canary";else if(window.navigator.appVersion.match(/Bowser\/([\w\W]*?)\./)[1]==="25")t.browser="bowser";else{if(window.navigator.appVersion.match(/Mozilla\/([\w\W]*?)\./)[1]!=="25")throw t.browser="none","WebRTC stack not available";t.browser="mozilla"}return t},Erizo.GetUserMedia=function(e,t){"use strict";if(typeof module!="undefined"&&module.exports)L.Logger.error("Video/audio streams not supported in erizofc yet");else try{navigator.webkitGetUserMedia("audio, video",t),console.log("GetUserMedia BOWSER")}catch(n){navigator.webkitGetUserMedia(e,t),console.log("GetUserMedia CHROME")}};var Erizo=Erizo||{};Erizo.Stream=function(e){"use strict";var t=Erizo.EventDispatcher(e),n;t.stream=e.stream,t.room=undefined,t.showing=!1,t.local=!1;if(e.local===undefined||e.local===!0)t.local=!0;return t.getID=function(){return e.streamID},t.getAttributes=function(){return e.attributes},t.hasAudio=function(){return e.audio},t.hasVideo=function(){return e.video},t.hasData=function(){return e.data},t.sendData=function(e){},t.init=function(){try{if(e.audio||e.video)L.Logger.debug("Requested access to local media"),Erizo.GetUserMedia({video:e.video,audio:e.audio},function(e){L.Logger.info("User has granted access to local media."),t.stream=e;var n=Erizo.StreamEvent({type:"access-accepted"});t.dispatchEvent(n)},function(e){L.Logger.error("Failed to get access to local media. Error code was "+e.code+".");var n=Erizo.StreamEvent({type:"access-denied"});t.dispatchEvent(n)});else{var n=Erizo.StreamEvent({type:"access-accepted"});t.dispatchEvent(n)}}catch(r){L.Logger.error("Error accessing to local media")}},t.show=function(e,n){t.elementID=e;if(t.hasVideo()&&e!==undefined){var r=new Erizo.VideoPlayer({id:t.getID(),stream:t.stream,elementID:e,options:n});t.player=r,t.showing=!0}},t.hide=function(){t.showing&&t.player!==undefined&&(t.player.destroy(),t.showing=!1)},n=function(){if(t.player!==undefined&&t.stream!==undefined){var e=t.player.video,n=document.defaultView.getComputedStyle(e),r=parseInt(n.getPropertyValue("width"),10),i=parseInt(n.getPropertyValue("height"),10),s=parseInt(n.getPropertyValue("left"),10),o=parseInt(n.getPropertyValue("top"),10),u=document.getElementById(t.elementID),a=document.defaultView.getComputedStyle(u),f=parseInt(a.getPropertyValue("width"),10),l=parseInt(a.getPropertyValue("height"),10),c=document.createElement("canvas"),h;return c.id="testing",c.width=f,c.height=l,c.setAttribute("style","display: none"),h=c.getContext("2d"),h.drawImage(e,s,o,r,i),c}return null},t.getVideoFrameURL=function(){var e=n();return e!==null?e.toDataURL():null},t.getVideoFrame=function(){var e=n();return e!==null?e.getContext("2d").getImageData(0,0,e.width,e.height):null},t},module.exports=Erizo;