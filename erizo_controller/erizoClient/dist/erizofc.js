/*
*/
var io = require('socket.io-client');
var Erizo=Erizo||{};
Erizo.EventDispatcher=function(c){var a={};c.dispatcher={};c.dispatcher.eventListeners={};a.addEventListener=function(a,b){void 0===c.dispatcher.eventListeners[a]&&(c.dispatcher.eventListeners[a]=[]);c.dispatcher.eventListeners[a].push(b)};a.removeEventListener=function(a,b){var f;f=c.dispatcher.eventListeners[a].indexOf(b);-1!==f&&c.dispatcher.eventListeners[a].splice(f,1)};a.dispatchEvent=function(a){var b;L.Logger.debug("Event: "+a.type);for(b in c.dispatcher.eventListeners[a.type])if(c.dispatcher.eventListeners[a.type].hasOwnProperty(b))c.dispatcher.eventListeners[a.type][b](a)};return a};
Erizo.LynckiaEvent=function(c){var a={};a.type=c.type;return a};Erizo.RoomEvent=function(c){var a=Erizo.LynckiaEvent(c);a.streams=c.streams;return a};Erizo.StreamEvent=function(c){var a=Erizo.LynckiaEvent(c);a.stream=c.stream;a.msg=c.msg;return a};Erizo.PublisherEvent=function(c){return Erizo.LynckiaEvent(c)};Erizo=Erizo||{};Erizo.FcStack=function(){return{addStream:function(){}}};Erizo=Erizo||{};
Erizo.ChromeStableStack=function(c){var a={},d=webkitRTCPeerConnection;a.pc_config={iceServers:[]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});a.mediaConstraints={mandatory:{OfferToReceiveVideo:"true",OfferToReceiveAudio:"true"}};a.roapSessionId=103;a.peerConnection=new d(a.pc_config);a.peerConnection.onicecandidate=function(b){b.candidate?a.iceCandidateCount+=1:(a.moreIceComing=!1,a.markActionNeeded())};console.log('Created webkitRTCPeerConnnection with config "'+JSON.stringify(a.pc_config)+
'".');a.processSignalingMessage=function(b){console.log("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),
a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp!==
a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):console.log("Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;console.log("Sending OFFER: ",a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state=
"offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(console.log((new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var e=
{};e.messageType=b;e.sdp=c;"OFFER"===b?(e.offererSessionId=a.sessionId,e.answererSessionId=a.otherSessionId,e.seq=a.sequenceNumber+=1,e.tiebreaker=Math.floor(429496723*Math.random()+1)):(e.offererSessionId=a.incomingMessage.offererSessionId,e.answererSessionId=a.sessionId,e.seq=a.incomingMessage.seq);a.onsignalingmessage(JSON.stringify(e))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=
0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Erizo=Erizo||{};
Erizo.ChromeCanaryStack=function(c){var a={},d=webkitRTCPeerConnection;a.pc_config={iceServers:[]};void 0!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl});a.mediaConstraints={mandatory:{OfferToReceiveVideo:"true",OfferToReceiveAudio:"true"}};a.roapSessionId=103;a.peerConnection=new d(a.pc_config);a.peerConnection.onicecandidate=function(b){console.log("PeerConnection: ",c.session_id);if(b.candidate)a.iceCandidateCount+=1;else if(console.log("State: "+a.peerConnection.iceGatheringState),void 0===
a.ices&&(a.ices=0),a.ices+=1,console.log(a.ices),1<=a.ices&&a.moreIceComing)a.moreIceComing=!1,a.markActionNeeded()};console.log('Created webkitRTCPeerConnnection with config "'+JSON.stringify(a.pc_config)+'".');a.processSignalingMessage=function(b){console.log("Activity on conn "+a.sessionId);var b=JSON.parse(b),c,e;a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):
a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(c=RegExp(/m=video[\w\W]*\r\n/g),e=b.sdp.match(c),console.log(e),b.sdp=b.sdp.replace(c,e+"b=AS:100\r\n"),b={sdp:b.sdp,type:"answer"},console.log("Received ANSWER: ",b),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):
"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};
a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){var c=b.sdp;console.log("Changed",b.sdp);c!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):console.log("Not sending a new offer")},
null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;console.log("Sending OFFER: ",a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(console.log((new Date).getTime()+": Starting ICE in responder"),a.iceStarted=
!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var e={};e.messageType=b;e.sdp=c;"OFFER"===b?(e.offererSessionId=a.sessionId,e.answererSessionId=a.otherSessionId,e.seq=a.sequenceNumber+=1,e.tiebreaker=
Math.floor(429496723*Math.random()+1)):(e.offererSessionId=a.incomingMessage.offererSessionId,e.answererSessionId=a.sessionId,e.seq=a.incomingMessage.seq);a.onsignalingmessage(JSON.stringify(e))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};
a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Erizo=Erizo||{};Erizo.sessionId=103;
Erizo.Connection=function(c){var a={};c.session_id=Erizo.sessionId+=1;a.browser="";if("undefined"!==typeof module&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported in erizofc yet"),a=Erizo.FcStack(c);else if("23"===window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])console.log("Stable!"),a=Erizo.ChromeStableStack(c),a.browser="chrome-stable";else if("25"===window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])console.log("Canary!"),a=Erizo.ChromeCanaryStack(c),
a.browser="chrome-canary";else if("25"===window.navigator.appVersion.match(/Bowser\/([\w\W]*?)\./)[1])a.browser="bowser";else if("25"===window.navigator.appVersion.match(/Mozilla\/([\w\W]*?)\./)[1])a.browser="mozilla";else throw a.browser="none","WebRTC stack not available";return a};
Erizo.GetUserMedia=function(c,a){if("undefined"!==typeof module&&module.exports)L.Logger.error("Video/audio streams not supported in erizofc yet");else try{navigator.webkitGetUserMedia("audio, video",a),console.log("GetUserMedia BOWSER")}catch(d){navigator.webkitGetUserMedia(c,a),console.log("GetUserMedia CHROME")}};Erizo=Erizo||{};
Erizo.Stream=function(c){var a=Erizo.EventDispatcher(c),d;a.stream=c.stream;a.room=void 0;a.showing=!1;a.local=!1;if(void 0===c.local||!0===c.local)a.local=!0;a.getID=function(){return c.streamID};a.getAttributes=function(){return c.attributes};a.hasAudio=function(){return c.audio};a.hasVideo=function(){return c.video};a.hasData=function(){return c.data};a.sendData=function(){};a.init=function(){try{if(c.audio||c.video)L.Logger.debug("Requested access to local media"),Erizo.GetUserMedia({video:c.video,audio:c.audio},
function(b){L.Logger.info("User has granted access to local media.");a.stream=b;b=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(b)},function(b){L.Logger.error("Failed to get access to local media. Error code was "+b.code+".");b=Erizo.StreamEvent({type:"access-denied"});a.dispatchEvent(b)});else{var b=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(b)}}catch(d){L.Logger.error("Error accessing to local media")}};a.show=function(b,c){a.elementID=b;if(a.hasVideo()&&void 0!==
b){var d=new Erizo.VideoPlayer({id:a.getID(),stream:a.stream,elementID:b,options:c});a.player=d;a.showing=!0}};a.hide=function(){a.showing&&void 0!==a.player&&(a.player.destroy(),a.showing=!1)};d=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),i=parseInt(c.getPropertyValue("height"),10),j=parseInt(c.getPropertyValue("left"),10),c=parseInt(c.getPropertyValue("top"),10),k=document.getElementById(a.elementID),
g=document.defaultView.getComputedStyle(k),k=parseInt(g.getPropertyValue("width"),10),g=parseInt(g.getPropertyValue("height"),10),h=document.createElement("canvas");h.id="testing";h.width=k;h.height=g;h.setAttribute("style","display: none");h.getContext("2d").drawImage(b,j,c,d,i);return h}return null};a.getVideoFrameURL=function(){var a=d();return null!==a?a.toDataURL():null};a.getVideoFrame=function(){var a=d();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};return a};Erizo=Erizo||{};
Erizo.Room=function(c){var a=Erizo.EventDispatcher(c),d,b,f,e,i;a.remoteStreams={};a.localStreams={};a.roomID="";a.socket={};a.state=0;a.addEventListener("room-disconnected",function(){var b,c;a.state=0;for(b in a.remoteStreams)a.remoteStreams.hasOwnProperty(b)&&(c=a.remoteStreams[b],i(c),delete a.remoteStreams[b],c=Erizo.StreamEvent({type:"stream-removed",stream:c}),a.dispatchEvent(c));a.remoteStreams={};for(b in a.localStreams)a.localStreams.hasOwnProperty(b)&&(c=a.localStreams[b],i(c),delete a.localStreams[b]);
try{a.socket.disconnect()}catch(g){L.Logger.debug("Socket already disconnected")}a.socket=void 0});i=function(a){void 0!==a.stream&&(a.hide(),a.pc.close())};e=function(a,c){a.local&&b("sendDataStream",{id:a.getID(),msg:c})};d=function(c,d,g){a.socket=io.connect(c.host,{reconnect:!1});a.socket.on("onAddStream",function(b){console.log(b);var c=Erizo.Stream({streamID:b.id,local:!1,audio:b.audio,video:b.video,data:b.data,attributes:b.attributes});a.remoteStreams[b.id]=c;b=Erizo.StreamEvent({type:"stream-added",
stream:c});a.dispatchEvent(b)});a.socket.on("onDataStream",function(b){var c=a.remoteStreams[b.id],b=Erizo.StreamEvent({type:"stream-data",msg:b.msg,stream:c});c.dispatchEvent(b)});a.socket.on("onRemoveStream",function(b){var c=a.remoteStreams[b.id];delete a.remoteStreams[b.id];i(c);b=Erizo.StreamEvent({type:"stream-removed",stream:c});a.dispatchEvent(b)});a.socket.on("disconnect",function(){L.Logger.info("Socket disconnected");var b=Erizo.RoomEvent({type:"room-disconnected"});a.dispatchEvent(b)});
b("token",c,d,g)};b=function(b,c,g,h){a.socket.emit(b,c,function(a,b){"success"===a?void 0!==g&&g(b):void 0!==h&&h(b)})};f=function(b,c,g,h){a.socket.emit(b,c,g,function(a,b){void 0!==h&&h(a,b)})};a.connect=function(){var b=L.Base64.decodeBase64(c.token);0!==a.state&&L.Logger.error("Room already connected");a.state=1;d(JSON.parse(b),function(b){var c=0,j=[],d,e,f;d=b.streams;e=b.id;a.stunServerUrl=b.stunServerUrl;a.state=2;for(c in d)d.hasOwnProperty(c)&&(f=d[c],b=Erizo.Stream({streamID:f.id,local:!1,
audio:f.audio,video:f.video,data:f.data,attributes:f.attributes}),j.push(b),a.remoteStreams[f.id]=b);a.roomID=e;L.Logger.info("Connected to room "+a.roomID);c=Erizo.RoomEvent({type:"room-connected",streams:j});a.dispatchEvent(c)},function(a){L.Logger.error("Not Connected! Error: "+a)})};a.disconnect=function(){var b=Erizo.RoomEvent({type:"room-disconnected"});a.dispatchEvent(b)};a.publish=function(b){b.local&&void 0===a.localStreams[b.getID()]&&(b.hasAudio()||b.hasVideo()?(b.pc=Erizo.Connection({callback:function(c){f("publish",
{state:"offer",data:!0,audio:b.hasAudio(),video:b.hasVideo(),attributes:b.getAttributes()},c,function(c,h){b.pc.onsignalingmessage=function(c){b.pc.onsignalingmessage=function(){};f("publish",{state:"ok",streamId:h,data:!0,audio:b.hasAudio(),video:b.hasVideo(),attributes:b.getAttributes()},c);L.Logger.info("Stream published");b.getID=function(){return h};b.sendData=function(a){e(b,a)};a.localStreams[h]=b};b.pc.processSignalingMessage(c)})},stunServerUrl:a.stunServerUrl}),b.pc.addStream(b.stream)):
b.hasData()&&f("publish",{state:"data",data:!0,audio:!1,video:!1,attributes:b.getAttributes()},void 0,function(c,g){L.Logger.info("Stream published");b.getID=function(){return g};b.sendData=function(a){e(b,a)};a.localStreams[g]=b}))};a.unpublish=function(a){a.local&&b("unpublish",a.getID())};a.subscribe=function(b){b.local||(b.hasVideo()||b.hasAudio()?(b.pc=Erizo.Connection({callback:function(a){f("subscribe",{streamId:b.getID()},a,function(a){b.pc.processSignalingMessage(a)})},stunServerUrl:a.stunServerUrl}),
b.pc.onaddstream=function(c){L.Logger.info("Stream subscribed");b.stream=c.stream;c=Erizo.StreamEvent({type:"stream-subscribed",stream:b});a.dispatchEvent(c)}):b.hasData()&&f("subscribe",{streamId:b.getID()},void 0,function(){L.Logger.info("Stream subscribed");var c=Erizo.StreamEvent({type:"stream-subscribed",stream:b});a.dispatchEvent(c)}),L.Logger.info("Subscribing to: "+b.getID()))};a.unsubscribe=function(c){void 0!==a.socket&&(c.local||b("unsubscribe",c.getID(),function(){i(c)},function(){L.Logger.error("Error calling unsubscribe.")}))};
a.getStreamsByAttribute=function(b,c){var g=[],d,e;for(d in a.remoteStreams)a.remoteStreams.hasOwnProperty(d)&&(e=a.remoteStreams[d],void 0!==e.getAttributes()&&void 0!==e.getAttributes()[b]&&e.getAttributes()[b]===c&&g.push(e));return g};return a};var L=L||{};
L.Logger=function(c){return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){c.Logger.panel=document.createElement("textarea");c.Logger.panel.setAttribute("id","lynckia-logs");c.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");c.Logger.panel.setAttribute("rows",20);c.Logger.panel.setAttribute("cols",20);c.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(c.Logger.panel)},setLogLevel:function(a){a>c.Logger.NONE?a=c.Logger.NONE:a<
c.Logger.DEBUG&&(a=c.Logger.DEBUG);c.Logger.logLevel=a},log:function(a,d){var b="";a<c.Logger.logLevel||(a===c.Logger.DEBUG?b+="DEBUG":a===c.Logger.TRACE?b+="TRACE":a===c.Logger.INFO?b+="INFO":a===c.Logger.WARNING?b+="WARNING":a===c.Logger.ERROR&&(b+="ERROR"),b=b+": "+d,void 0!==c.Logger.panel?c.Logger.panel.value=c.Logger.panel.value+"\n"+b:console.log(b))},debug:function(a){c.Logger.log(c.Logger.DEBUG,a)},trace:function(a){c.Logger.log(c.Logger.TRACE,a)},info:function(a){c.Logger.log(c.Logger.INFO,
a)},warning:function(a){c.Logger.log(c.Logger.WARNING,a)},error:function(a){c.Logger.log(c.Logger.ERROR,a)}}}(L);L=L||{};
L.Base64=function(){var c,a,d,b,f,e,i,j,k;c="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");a=[];for(f=0;f<c.length;f+=1)a[c[f]]=f;e=function(a){d=a;b=0};i=function(){var a;if(!d||b>=d.length)return-1;a=d.charCodeAt(b)&255;b+=1;return a};j=function(){if(!d)return-1;for(;;){if(b>=d.length)return-1;var c=d.charAt(b);b+=1;if(a[c])return a[c];if("A"===c)return 0}};k=function(a){a=a.toString(16);1===a.length&&(a=
"0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b,d,f;e(a);a="";b=Array(3);d=0;for(f=!1;!f&&-1!==(b[0]=i());)if(b[1]=i(),b[2]=i(),a+=c[b[0]>>2],-1!==b[1]?(a+=c[b[0]<<4&48|b[1]>>4],-1!==b[2]?(a+=c[b[1]<<2&60|b[2]>>6],a+=c[b[2]&63]):(a+=c[b[1]<<2&60],a+="=",f=!0)):(a+=c[b[0]<<4&48],a+="=",a+="=",f=!0),d+=4,76<=d)a+="\n",d=0;return a},decodeBase64:function(a){var b,c;e(a);a="";b=Array(4);for(c=!1;!c&&-1!==(b[0]=j())&&-1!==(b[1]=j());)b[2]=j(),b[3]=j(),a+=k(b[0]<<2&255|b[1]>>4),-1!==
b[2]?(a+=k(b[1]<<4&255|b[2]>>2),-1!==b[3]?a+=k(b[2]<<6&255|b[3]):c=!0):c=!0;return a}}}(L);Erizo=Erizo||{};Erizo.View=function(){var c=Erizo.EventDispatcher({});c.url="http://chotis2.dit.upm.es:3000";return c};Erizo=Erizo||{};
Erizo.VideoPlayer=function(c){var a=Erizo.View({});a.id=c.id;a.stream=c.stream;a.elementID=c.elementID;a.destroy=function(){a.video.pause();clearInterval(a.resize);a.parentNode.removeChild(a.div)};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,b,c){document.getElementById(b).value=unescape(c)});L.Logger.debug("Creating URL from stream "+a.stream);a.stream_url=webkitURL.createObjectURL(a.stream);a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("style",
"width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");a.loader=document.createElement("img");a.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px");a.loader.setAttribute("id","back_"+a.id);a.loader.setAttribute("src",a.url+"/assets/loader.gif");a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("style","width: 100%; height: 100%; position: absolute");
a.video.setAttribute("autoplay","autoplay");void 0!==a.elementID?(document.getElementById(a.elementID).appendChild(a.div),a.container=document.getElementById(a.elementID)):(document.body.appendChild(a.div),a.container=document.body);a.parentNode=a.div.parentNode;a.div.appendChild(a.loader);a.div.appendChild(a.video);a.containerWidth=0;a.containerHeight=0;a.resize=setInterval(function(){var c=a.container.offsetWidth,b=a.container.offsetHeight;if(c!==a.containerWidth||b!==a.containerHeight){if(c*0.75>
b){a.video.style.width=c+"px";a.video.style.height=0.75*c+"px";a.video.style.top=-(0.75*c/2-b/2)+"px";a.video.style.left="0px"}else{a.video.style.height=b+"px";a.video.style.width=4/3*b+"px";a.video.style.left=-(4/3*b/2-c/2)+"px";a.video.style.top="0px"}a.containerWidth=c;a.containerHeight=b}},500);a.bar=new Erizo.Bar({elementID:"player_"+a.id,id:a.id,video:a.video,options:c.options});a.div.onmouseover=function(){a.bar.display()};a.div.onmouseout=function(){a.bar.hide()};a.video.src=a.stream_url;
return a};Erizo=Erizo||{};
Erizo.Bar=function(c){var a=Erizo.View({}),d,b;a.elementID=c.elementID;a.id=c.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.link=document.createElement("a");a.link.setAttribute("href","http://www.lynckia.com/");a.link.setAttribute("target","_blank");
a.logo=document.createElement("img");a.logo.setAttribute("style","width: 10%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("alt","Lynckia");a.logo.setAttribute("src",a.url+"/assets/star.svg");b=function(b){"block"!==b?b="none":clearTimeout(d);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+b)};a.display=function(){b("block")};a.hide=function(){d=setTimeout(b,1E3)};document.getElementById(a.elementID).appendChild(a.div);
a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);if(void 0===c.options||void 0===c.options.speaker||!0===c.options.speaker)a.speaker=new Erizo.Speaker({elementID:"subbar_"+a.id,id:a.id,video:c.video});a.display();a.hide();return a};Erizo=Erizo||{};
Erizo.Speaker=function(c){var a=Erizo.View({}),d;a.elementID=c.elementID;a.video=c.video;a.id=c.id;a.div=document.createElement("div");a.div.setAttribute("style","width: 10%; height: 100%; max-width: 30px; position: absolute; bottom: 0; right: 0;");a.icon=document.createElement("img");a.icon.setAttribute("id","volume_"+a.id);a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.icon.setAttribute("style","width: 100%; height: 100%; position: absolute;");a.div.appendChild(a.icon);a.picker=document.createElement("input");
a.picker.setAttribute("id","picker_"+a.id);a.picker.type="range";a.picker.min=0;a.picker.max=100;a.picker.step=10;a.picker.value=50;a.div.appendChild(a.picker);a.video.volume=a.picker.value/100;a.picker.oninput=function(){0<a.picker.value?a.icon.setAttribute("src",a.url+"/assets/sound48.png"):a.icon.setAttribute("src",a.url+"/assets/mute48.png");a.video.volume=a.picker.value/100};d=function(b){a.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: "+a.div.offsetHeight+
"px; right: 0px; -webkit-appearance: slider-vertical; display: "+b)};a.div.onmouseover=function(){d("block")};a.div.onmouseout=function(){d("none")};d("none");document.getElementById(a.elementID).appendChild(a.div);return a};
module.exports = Erizo;
