var CryptoJS=CryptoJS||function(d,g){var i={},a=i.lib={},c=a.Base=function(){function e(){}return{extend:function(b){e.prototype=this;var a=new e;b&&a.mixIn(b);a.$super=this;return a},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var b in e)e.hasOwnProperty(b)&&(this[b]=e[b]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),n=a.WordArray=c.extend({init:function(e,b){e=
this.words=e||[];this.sigBytes=b!=g?b:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var b=this.words,a=e.words,f=this.sigBytes,e=e.sigBytes;this.clamp();if(f%4)for(var c=0;c<e;c++)b[f+c>>>2]|=(a[c>>>2]>>>24-8*(c%4)&255)<<24-8*((f+c)%4);else if(65535<a.length)for(c=0;c<e;c+=4)b[f+c>>>2]=a[c>>>2];else b.push.apply(b,a);this.sigBytes+=e;return this},clamp:function(){var e=this.words,b=this.sigBytes;e[b>>>2]&=4294967295<<32-8*(b%4);e.length=d.ceil(b/4)},clone:function(){var e=
c.clone.call(this);e.words=this.words.slice(0);return e},random:function(e){for(var b=[],a=0;a<e;a+=4)b.push(4294967296*d.random()|0);return n.create(b,e)}}),m=i.enc={},h=m.Hex={stringify:function(e){for(var b=e.words,e=e.sigBytes,a=[],f=0;f<e;f++){var c=b[f>>>2]>>>24-8*(f%4)&255;a.push((c>>>4).toString(16));a.push((c&15).toString(16))}return a.join("")},parse:function(e){for(var b=e.length,a=[],f=0;f<b;f+=2)a[f>>>3]|=parseInt(e.substr(f,2),16)<<24-4*(f%8);return n.create(a,b/2)}},l=m.Latin1={stringify:function(b){for(var a=
b.words,b=b.sigBytes,f=[],c=0;c<b;c++)f.push(String.fromCharCode(a[c>>>2]>>>24-8*(c%4)&255));return f.join("")},parse:function(b){for(var a=b.length,f=[],c=0;c<a;c++)f[c>>>2]|=(b.charCodeAt(c)&255)<<24-8*(c%4);return n.create(f,a)}},b=m.Utf8={stringify:function(b){try{return decodeURIComponent(escape(l.stringify(b)))}catch(a){throw Error("Malformed UTF-8 data");}},parse:function(b){return l.parse(unescape(encodeURIComponent(b)))}},f=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=n.create();
this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=b.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var a=this._data,f=a.words,c=a.sigBytes,h=this.blockSize,i=c/(4*h),i=b?d.ceil(i):d.max((i|0)-this._minBufferSize,0),b=i*h,c=d.min(4*b,c);if(b){for(var g=0;g<b;g+=h)this._doProcessBlock(f,g);g=f.splice(0,b);a.sigBytes-=c}return n.create(g,c)},clone:function(){var b=c.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});a.Hasher=f.extend({init:function(){this.reset()},
reset:function(){f.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);this._doFinalize();return this._hash},clone:function(){var b=f.clone.call(this);b._hash=this._hash.clone();return b},blockSize:16,_createHelper:function(b){return function(a,f){return b.create(f).finalize(a)}},_createHmacHelper:function(b){return function(a,f){return p.HMAC.create(b,f).finalize(a)}}});var p=i.algo={};return i}(Math);
(function(){var d=CryptoJS,g=d.lib,i=g.WordArray,g=g.Hasher,a=[],c=d.algo.SHA1=g.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,g){for(var h=this._hash.words,i=h[0],b=h[1],f=h[2],d=h[3],e=h[4],j=0;80>j;j++){if(16>j)a[j]=c[g+j]|0;else{var k=a[j-3]^a[j-8]^a[j-14]^a[j-16];a[j]=k<<1|k>>>31}k=(i<<5|i>>>27)+e+a[j];k=20>j?k+((b&f|~b&d)+1518500249):40>j?k+((b^f^d)+1859775393):60>j?k+((b&f|b&d|f&d)-1894007588):k+((b^f^d)-
899497514);e=d;d=f;f=b<<30|b>>>2;b=i;i=k}h[0]=h[0]+i|0;h[1]=h[1]+b|0;h[2]=h[2]+f|0;h[3]=h[3]+d|0;h[4]=h[4]+e|0},_doFinalize:function(){var a=this._data,c=a.words,i=8*this._nDataBytes,d=8*a.sigBytes;c[d>>>5]|=128<<24-d%32;c[(d+64>>>9<<4)+15]=i;a.sigBytes=4*c.length;this._process()}});d.SHA1=g._createHelper(c);d.HmacSHA1=g._createHmacHelper(c)})();
(function(){var d=CryptoJS,g=d.enc.Utf8;d.algo.HMAC=d.lib.Base.extend({init:function(d,a){d=this._hasher=d.create();"string"==typeof a&&(a=g.parse(a));var c=d.blockSize,n=4*c;a.sigBytes>n&&(a=d.finalize(a));for(var m=this._oKey=a.clone(),h=this._iKey=a.clone(),l=m.words,b=h.words,f=0;f<c;f++)l[f]^=1549556828,b[f]^=909522486;m.sigBytes=h.sigBytes=n;this.reset()},reset:function(){var d=this._hasher;d.reset();d.update(this._iKey)},update:function(d){this._hasher.update(d);return this},finalize:function(d){var a=
this._hasher,d=a.finalize(d);a.reset();return a.finalize(this._oKey.clone().concat(d))}})})();var N=N||{};N.authors=["aalonsog@dit.upm.es","prodriguez@dit.upm.es","jcervino@dit.upm.es"];N.version=0.1;N=N||{};
N.Base64=function(){var d,g,i,a,c,n,m,h,l;d="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");g=[];for(c=0;c<d.length;c+=1)g[d[c]]=c;n=function(b){i=b;a=0};m=function(){var b;if(!i||a>=i.length)return-1;b=i.charCodeAt(a)&255;a+=1;return b};h=function(){if(!i)return-1;for(;;){if(a>=i.length)return-1;var b=i.charAt(a);a+=1;if(g[b])return g[b];if("A"===b)return 0}};l=function(b){b=b.toString(16);1===b.length&&(b=
"0"+b);return unescape("%"+b)};return{encodeBase64:function(b){var a,c,e;n(b);b="";a=Array(3);c=0;for(e=!1;!e&&-1!==(a[0]=m());)if(a[1]=m(),a[2]=m(),b+=d[a[0]>>2],-1!==a[1]?(b+=d[a[0]<<4&48|a[1]>>4],-1!==a[2]?(b+=d[a[1]<<2&60|a[2]>>6],b+=d[a[2]&63]):(b+=d[a[1]<<2&60],b+="=",e=!0)):(b+=d[a[0]<<4&48],b+="=",b+="=",e=!0),c+=4,76<=c)b+="\n",c=0;return b},decodeBase64:function(b){var a,c;n(b);b="";a=Array(4);for(c=!1;!c&&-1!==(a[0]=h())&&-1!==(a[1]=h());)a[2]=h(),a[3]=h(),b+=l(a[0]<<2&255|a[1]>>4),-1!==
a[2]?(b+=l(a[1]<<4&255|a[2]>>2),-1!==a[3]?b+=l(a[2]<<6&255|a[3]):c=!0):c=!0;return b}}}(N);N=N||{};
N.API=function(d){var g,i;g=function(a,c,g,m,h,l){var b,f,p,e,j,k,o;b=d.API.params.service;f=d.API.params.key;""===b||""===f?console.log("ServiceID and Key are required!!"):(p=(new Date).getTime(),e=Math.floor(99999*Math.random()),j=p+","+e,k="MAuth realm=http://marte3.dit.upm.es,mauth_signature_method=HMAC_SHA1",""!==h&&""!==l&&(k=k+",mauth_username="+h+",mauth_role="+l,j+=","+h+","+l),h=i(j,f),k=k+",mauth_serviceid="+b+",mauth_cnonce="+e+",mauth_timestamp="+p+",mauth_signature="+h,o=new XMLHttpRequest,o.onreadystatechange=
function(){o.readyState===4&&a(o.responseText)},o.open(c,m,!0),o.setRequestHeader("Authorization",k),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(g)))};i=function(a,c){var g;g=CryptoJS.HmacSHA1(a,c).toString(CryptoJS.enc.Hex);return d.Base64.encodeBase64(g)};return{params:{service:void 0,key:void 0},init:function(a,c){d.API.params.service=a;d.API.params.key=c},createRoom:function(a,c,d){g(function(a){a=JSON.parse(a);c(a)},"POST",{name:a,options:d},"http://chotis2.dit.upm.es:3000/rooms")},
getRooms:function(a){g(a,"GET",void 0,"http://chotis2.dit.upm.es:3000/rooms")},getRoom:function(a,c){g(c,"GET",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a)},deleteRoom:function(a,c){g(c,"DELETE",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a)},createToken:function(a,c,d,i){g(i,"POST",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a+"/tokens",c,d)},createService:function(a,c,d){g(d,"POST",{name:a,key:c},"http://chotis2.dit.upm.es:3000/services/")},getServices:function(a){g(a,"GET",void 0,"http://chotis2.dit.upm.es:3000/services/")},
getService:function(a,c){g(c,"GET",void 0,"http://chotis2.dit.upm.es:3000/services/"+a)},deleteService:function(a,c){g(c,"DELETE",void 0,"http://chotis2.dit.upm.es:3000/services/"+a)},getUsers:function(a,c){g(c,"GET",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a+"/users/")},getUser:function(a,c,d){g(d,"GET",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a+"/users/"+c)},deleteUser:function(a,c,d){g(d,"DELETE",void 0,"http://chotis2.dit.upm.es:3000/rooms/"+a+"/users/"+c)}}}(N);
